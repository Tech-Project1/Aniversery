<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Love Scavenger Hunt</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f8cdda, #1d2b64);
    color: #fff;
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }
  #app {
    max-width: 600px;
    width: 90%;
    background: rgba(0,0,0,0.6);
    padding: 20px;
    border-radius: 12px;
    margin-top: 40px;
    box-shadow: 0 0 20px #ff69b4;
  }
  h1, h2 {
    text-align: center;
    color: #ff69b4;
  }
  button {
    background: #ff69b4;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    font-weight: bold;
    margin: 10px auto;
    display: block;
    font-size: 1rem;
    box-shadow: 0 0 8px #ff69b4;
  }
  button:disabled {
    background: #999;
    cursor: not-allowed;
    box-shadow: none;
  }
  .hidden {
    display: none;
  }
  .memory-grid {
    display: grid;
    grid-template-columns: repeat(4, 70px);
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
  }
  .card {
    width: 70px;
    height: 70px;
    background: #ff69b4;
    border-radius: 10px;
    cursor: pointer;
    color: transparent;
    font-size: 2.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    box-shadow: 0 0 6px #ff69b4;
  }
  .card.flipped, .card.matched {
    background: #fff;
    color: #ff69b4;
    cursor: default;
  }
  #mazeCanvas {
    background: #fff0f5;
    display: block;
    margin: 20px auto;
    border-radius: 8px;
    box-shadow: 0 0 20px #ff69b4;
  }
  #scrambleInput, #finalInput, #guessInput {
    width: 80%;
    padding: 8px;
    border-radius: 6px;
    border: none;
    font-size: 1.1rem;
    margin-top: 10px;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
  #message {
    margin-top: 15px;
    text-align: center;
    font-size: 1.2rem;
    color: #ffb6c1;
    min-height: 2em;
  }
  #clues {
    margin-top: 15px;
    text-align: center;
    color: #ff69b4;
  }
  #reactionBtn {
    background: #ccc;
    color: #333;
    font-size: 1.5rem;
    padding: 20px 40px;
    margin: 30px auto;
    display: block;
    border-radius: 12px;
    box-shadow: 0 0 10px #aaa;
    cursor: pointer;
  }
  #movingHeart {
    position: absolute;
    font-size: 3rem;
    cursor: pointer;
    user-select: none;
    transition: top 0.3s ease, left 0.3s ease;
  }
  .slider-emoji {
    font-size: 2.5rem;
    cursor: pointer;
    margin: 5px;
    display: inline-block;
    user-select: none;
    border-radius: 8px;
    padding: 10px 14px;
    background: #ff69b4;
    box-shadow: 0 0 8px #ff69b4;
  }
  .slider-selected {
    box-shadow: 0 0 15px #fff;
  }
</style>
</head>
<body>
  <div id="app">
    <!-- Content dynamically injected here -->
  </div>

<script>
  const app = document.getElementById('app');
  
  let clues = [];
  let currentState;

  const STATE = {
    START: 'start',
    MEMORY_GAME: 'memory',
    MAZE_GAME: 'maze',
    SCRAMBLE_GAME: 'scramble',
    REACTION_GAME: 'reaction',
    QUIZ_GAME: 'quiz',
    CLICK_HEART_GAME: 'clickHeart',
    GUESS_NUMBER_GAME: 'guessNumber',
    EMOJI_SLIDER_GAME: 'emojiSlider',
    FINAL_PUZZLE: 'final',
    LOVE_LETTER: 'loveLetter'
  };

  /* --- START --- */
  function renderStart() {
    app.innerHTML = `
      <h1>Welcome to Our Love Scavenger Hunt üíñ</h1>
      <p>Find all the clues by completing fun mini-games and unlock the secret love letter at the end!</p>
      <button id="startBtn">Start The Hunt</button>
    `;
    document.getElementById('startBtn').onclick = () => {
      currentState = STATE.MEMORY_GAME;
      renderMemoryGame();
    };
  }

  /* --- MEMORY MATCH --- */
  const memorySymbols = ['üçé', 'üçé', 'üåü', 'üåü', 'üíñ', 'üíñ', 'üåπ', 'üåπ'];
  let memoryFlipped = [];
  let memoryMatchedCount = 0;

  function shuffleArray(arr) {
    for(let i = arr.length - 1; i > 0; i--) {
      let j = Math.floor(Math.random() * (i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function renderMemoryGame() {
    memoryFlipped = [];
    memoryMatchedCount = 0;
    const cards = shuffleArray([...memorySymbols]);
    app.innerHTML = `
      <h2>Memory Match Game</h2>
      <p>Match all pairs to find the first clue!</p>
      <div class="memory-grid" id="memoryGrid"></div>
      <div id="message"></div>
    `;
    const grid = document.getElementById('memoryGrid');
    cards.forEach((symbol, i) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.symbol = symbol;
      card.dataset.index = i;
      card.textContent = symbol;
      card.style.color = 'transparent'; 
      card.onclick = () => memoryFlip(card);
      grid.appendChild(card);
    });
  }

  function memoryFlip(card) {
    if (memoryFlipped.length === 2 || card.classList.contains('flipped') || card.classList.contains('matched')) return;

    card.classList.add('flipped');
    card.style.color = 'inherit';
    memoryFlipped.push(card);

    if (memoryFlipped.length === 2) {
      if (memoryFlipped[0].dataset.symbol === memoryFlipped[1].dataset.symbol) {
        memoryFlipped.forEach(c => {
          c.classList.add('matched');
          c.style.cursor = 'default';
        });
        memoryMatchedCount++;
        if (memoryMatchedCount === memorySymbols.length / 2) {
          clues.push('ROSE');
          setTimeout(() => {
            alert('You found the first clue: ROSE üåπ');
            currentState = STATE.MAZE_GAME;
            renderMazeGame();
          }, 300);
        }
      } else {
        setTimeout(() => {
          memoryFlipped.forEach(c => {
            c.classList.remove('flipped');
            c.style.color = 'transparent';
          });
          memoryFlipped = [];
        }, 800);
        return;
      }
      memoryFlipped = [];
    }
  }

  /* --- MAZE RUNNER --- */
  const mazeWidth = 10;
  const mazeHeight = 10;
  const mazeCellSize = 40;
  let mazePlayer = { x: 0, y: 0 };
  const mazeEnd = { x: 9, y: 9 };
  const mazeMap = [
    [0,1,0,0,0,1,0,0,0,0],
    [0,1,0,1,0,1,0,1,1,0],
    [0,0,0,1,0,0,0,0,1,0],
    [1,1,0,1,1,1,1,0,1,0],
    [0,0,0,0,0,0,1,0,0,0],
    [0,1,1,1,1,0,1,1,1,0],
    [0,1,0,0,0,0,0,0,1,0],
    [0,1,0,1,1,1,1,0,1,0],
    [0,0,0,0,0,0,0,0,1,0],
    [1,1,1,1,1,1,1,0,0,0],
  ];

  function renderMazeGame() {
    mazePlayer = { x: 0, y: 0 };
    app.innerHTML = `
      <h2>Maze Runner</h2>
      <p>Use arrow keys to reach the glowing heart ‚ù§Ô∏è in the bottom-right corner!</p>
      <canvas id="mazeCanvas" width="${mazeWidth * mazeCellSize}" height="${mazeHeight * mazeCellSize}"></canvas>
      <div id="message"></div>
    `;

    document.addEventListener('keydown', mazeKeyHandler);
    drawMaze();
  }

  function drawMaze() {
    const canvas = document.getElementById('mazeCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(let y=0; y<mazeHeight; y++){
      for(let x=0; x<mazeWidth; x++){
        if(mazeMap[y][x] === 1){
          ctx.fillStyle = '#ff69b4';
          ctx.fillRect(x*mazeCellSize, y*mazeCellSize, mazeCellSize, mazeCellSize);
        } else {
          ctx.fillStyle = '#fff0f5';
          ctx.fillRect(x*mazeCellSize, y*mazeCellSize, mazeCellSize, mazeCellSize);
        }
      }
    }
    ctx.font = '32px serif';
    ctx.fillText('‚ù§Ô∏è', mazeEnd.x*mazeCellSize + 8, mazeEnd.y*mazeCellSize + 32);

    ctx.fillStyle = '#ff1493';
    ctx.beginPath();
    ctx.arc(mazePlayer.x*mazeCellSize + mazeCellSize/2, mazePlayer.y*mazeCellSize + mazeCellSize/2, mazeCellSize/3, 0, Math.PI*2);
    ctx.fill();
  }

  function mazeKeyHandler(e) {
    let dx = 0, dy = 0;
    if(e.key === 'ArrowUp') dy = -1;
    else if(e.key === 'ArrowDown') dy = 1;
    else if(e.key === 'ArrowLeft') dx = -1;
    else if(e.key === 'ArrowRight') dx = 1;
    else return;

    const newX = mazePlayer.x + dx;
    const newY = mazePlayer.y + dy;

    if(newX >= 0 && newX < mazeWidth && newY >= 0 && newY < mazeHeight && mazeMap[newY][newX] === 0){
      mazePlayer.x = newX;
      mazePlayer.y = newY;
      drawMaze();
      if(mazePlayer.x === mazeEnd.x && mazePlayer.y === mazeEnd.y){
        clues.push('KEY');
        alert('You found the second clue: KEY üóùÔ∏è');
        document.removeEventListener('keydown', mazeKeyHandler);
        currentState = STATE.SCRAMBLE_GAME;
        renderScrambleGame();
      }
    }
  }

  /* --- WORD SCRAMBLE --- */
  const scrambleWord = "LOVE";
  const scrambled = shuffleArray(scrambleWord.split('')).join('');

  function renderScrambleGame() {
    app.innerHTML = `
      <h2>Word Scramble</h2>
      <p>Unscramble the letters to find the final clue!</p>
      <p style="font-size:2rem; letter-spacing: 12px; text-align:center; margin-bottom:10px;">${scrambled}</p>
      <input id="scrambleInput" maxlength="${scrambleWord.length}" placeholder="Type your answer here..." autofocus />
      <button id="checkBtn">Check</button>
      <div id="message"></div>
    `;

    document.getElementById('checkBtn').onclick = checkScrambleAnswer;
    document.getElementById('scrambleInput').addEventListener('keydown', e => {
      if(e.key === 'Enter') checkScrambleAnswer();
    });
  }

  function checkScrambleAnswer() {
    const input = document.getElementById('scrambleInput').value.toUpperCase();
    const msg = document.getElementById('message');
    if(input === scrambleWord){
      clues.push('LOVE');
      msg.style.color = '#ff69b4';
      msg.textContent = "Correct! You've found the third clue!";
      setTimeout(() => {
        currentState = STATE.REACTION_GAME;
        renderReactionGame();
      }, 1500);
    } else {
      msg.style.color = '#f88';
      msg.textContent = "Oops! That's not right. Try again!";
    }
  }

  /* --- REACTION TEST --- */
  let reactionTimeout, reactionStartTime;
  function renderReactionGame() {
    app.innerHTML = `
      <h2>Reaction Test</h2>
      <p>Wait for the button to turn pink, then click it as fast as you can!</p>
      <button id="reactionBtn" disabled>Wait...</button>
      <div id="message"></div>
    `;

    const btn = document.getElementById('reactionBtn');
    const msg = document.getElementById('message');

    const delay = Math.floor(Math.random() * 3000) + 2000;

    reactionTimeout = setTimeout(() => {
      btn.disabled = false;
      btn.style.background = '#ff69b4';
      btn.textContent = 'CLICK ME!';
      reactionStartTime = performance.now();
    }, delay);

    btn.onclick = () => {
      if(btn.disabled) return;
      const reactionTime = performance.now() - reactionStartTime;
      btn.disabled = true;
      btn.style.background = '#ccc';
      btn.textContent = 'Clicked!';
      msg.style.color = '#ff69b4';
      msg.textContent = `Your reaction time: ${reactionTime.toFixed(0)} ms`;
      if(reactionTime < 1000){
        clues.push('HEART');
        setTimeout(() => {
          alert('Great job! You got the fourth clue: HEART ‚ù§Ô∏è');
          currentState = STATE.QUIZ_GAME;
          renderQuizGame();
        }, 1500);
      } else {
        msg.textContent += ' Try again for the clue!';
        setTimeout(() => {
          renderReactionGame();
        }, 2000);
      }
    };
  }

  /* --- QUIZ GAME --- */
  const quizQuestion = {
    question: "What day did we first meet?",
    options: ["Valentine's Day", "Our Anniversary Date", "Christmas", "New Year's Day"],
    answerIndex: 1
  };

  function renderQuizGame() {
    app.innerHTML = `
      <h2>Anniversary Quiz</h2>
      <p>${quizQuestion.question}</p>
      <div id="quizOptions"></div>
      <div id="message"></div>
    `;

    const optionsDiv = document.getElementById('quizOptions');
    quizQuestion.options.forEach((option, idx) => {
      const btn = document.createElement('button');
      btn.textContent = option;
      btn.onclick = () => checkQuizAnswer(idx);
      optionsDiv.appendChild(btn);
    });
  }

  function checkQuizAnswer(selectedIdx) {
    const msg = document.getElementById('message');
    if(selectedIdx === quizQuestion.answerIndex){
      clues.push('ROSES');
      msg.style.color = '#ff69b4';
      msg.textContent = "Correct! You've earned the fifth clue!";
      setTimeout(() => {
        currentState = STATE.CLICK_HEART_GAME;
        renderClickHeartGame();
      }, 1500);
    } else {
      msg.style.color = '#f88';
      msg.textContent = "Oops! Try again!";
    }
  }

  /* --- CLICK THE MOVING HEART --- */
  let clickHeartTimeout, clickHeartStartTime, clickHeartClicks;
  const maxClicksNeeded = 5;

  function renderClickHeartGame() {
    app.innerHTML = `
      <h2>Catch the Moving Heart!</h2>
      <p>Click the ‚ù§Ô∏è as many times as you can in 15 seconds! (${maxClicksNeeded} clicks to win)</p>
      <div id="clickHeartArea" style="position:relative; height:300px; border: 2px dashed #ff69b4; border-radius: 12px; margin: 20px auto;"></div>
      <div id="message"></div>
    `;

    const area = document.getElementById('clickHeartArea');

    const heart = document.createElement('div');
    heart.id = 'movingHeart';
    heart.textContent = '‚ù§Ô∏è';
    heart.style.top = '0px';
    heart.style.left = '0px';
    area.appendChild(heart);

    clickHeartClicks = 0;
    clickHeartStartTime = Date.now();

    function moveHeartRandomly() {
      const areaRect = area.getBoundingClientRect();
      const maxX = areaRect.width - 40;
      const maxY = areaRect.height - 40;
      const newX = Math.random() * maxX;
      const newY = Math.random() * maxY;
      heart.style.left = newX + 'px';
      heart.style.top = newY + 'px';
    }

    const intervalId = setInterval(moveHeartRandomly, 800);
    moveHeartRandomly();

    heart.onclick = () => {
      clickHeartClicks++;
      document.getElementById('message').textContent = `Clicked: ${clickHeartClicks}/${maxClicksNeeded}`;
      if(clickHeartClicks >= maxClicksNeeded){
        clearInterval(intervalId);
        clues.push('PINK');
        alert('Awesome! You caught the heart and earned the sixth clue: PINK üíñ');
        currentState = STATE.GUESS_NUMBER_GAME;
        renderGuessNumberGame();
      }
    };

    setTimeout(() => {
      clearInterval(intervalId);
      if(clickHeartClicks < maxClicksNeeded){
        alert('Time\'s up! Try again.');
        renderClickHeartGame();
      }
    }, 15000);
  }

  /* --- GUESS THE NUMBER --- */
  let secretNumber;

  function renderGuessNumberGame() {
    secretNumber = Math.floor(Math.random() * 10) + 1;
    app.innerHTML = `
      <h2>Guess the Number</h2>
      <p>Guess the secret number between 1 and 10.</p>
      <input type="number" id="guessInput" min="1" max="10" placeholder="Enter your guess" />
      <button id="guessBtn">Guess</button>
      <div id="message"></div>
    `;
    document.getElementById('guessBtn').onclick = checkGuess;
    document.getElementById('guessInput').addEventListener('keydown', e => {
      if(e.key === 'Enter') checkGuess();
    });
  }

  function checkGuess() {
    const input = Number(document.getElementById('guessInput').value);
    const msg = document.getElementById('message');
    if(!input || input < 1 || input > 10){
      msg.style.color = '#f88';
      msg.textContent = 'Please enter a number between 1 and 10.';
      return;
    }
    if(input === secretNumber){
      clues.push('SMILE');
      msg.style.color = '#ff69b4';
      msg.textContent = `Correct! The number was ${secretNumber}.`;
      setTimeout(() => {
        currentState = STATE.EMOJI_SLIDER_GAME;
        renderEmojiSliderGame();
      }, 1500);
    } else if(input < secretNumber){
      msg.style.color = '#ffb6c1';
      msg.textContent = 'Too low! Try a bigger number.';
    } else {
      msg.style.color = '#ffb6c1';
      msg.textContent = 'Too high! Try a smaller number.';
    }
  }

  /* --- EMOJI SLIDER PUZZLE --- */
  const correctOrder = ['üíñ', 'üåπ', 'üåü', 'üçé', 'üòä'];
  let sliderEmojis = [];

  function renderEmojiSliderGame() {
    sliderEmojis = shuffleArray([...correctOrder]);
    app.innerHTML = `
      <h2>Emoji Slider Puzzle</h2>
      <p>Swap emojis to arrange them in the right order.</p>
      <div id="emojiSlider" style="text-align:center; margin-top:20px;"></div>
      <button id="checkSliderBtn" disabled>Check Order</button>
      <div id="message"></div>
    `;

    const sliderDiv = document.getElementById('emojiSlider');
    sliderEmojis.forEach((emoji, i) => {
      const span = document.createElement('span');
      span.textContent = emoji;
      span.className = 'slider-emoji';
      span.dataset.index = i;
      sliderDiv.appendChild(span);
    });

    let selected = null;

    sliderDiv.querySelectorAll('.slider-emoji').forEach(span => {
      span.onclick = () => {
        if(selected === null){
          selected = span;
          span.classList.add('slider-selected');
        } else if(selected === span){
          selected.classList.remove('slider-selected');
          selected = null;
        } else {
          // Swap
          const i1 = Number(selected.dataset.index);
          const i2 = Number(span.dataset.index);
          [sliderEmojis[i1], sliderEmojis[i2]] = [sliderEmojis[i2], sliderEmojis[i1]];
          selected.textContent = sliderEmojis[i1];
          span.textContent = sliderEmojis[i2];
          selected.classList.remove('slider-selected');
          selected = null;
          document.getElementById('checkSliderBtn').disabled = false;
        }
      }
    });

    document.getElementById('checkSliderBtn').onclick = () => {
      const correct = sliderEmojis.every((e, i) => e === correctOrder[i]);
      const msg = document.getElementById('message');
      if(correct){
        clues.push('HUG');
        msg.style.color = '#ff69b4';
        msg.textContent = 'Perfect! You unlocked the final clue!';
        setTimeout(() => {
          currentState = STATE.FINAL_PUZZLE;
          renderFinalPuzzle();
        }, 1500);
      } else {
        msg.style.color = '#f88';
        msg.textContent = 'Not quite right yet. Keep trying!';
      }
    };
  }

  /* --- FINAL PUZZLE --- */
  function renderFinalPuzzle() {
    app.innerHTML = `
      <h2>Final Puzzle</h2>
      <p>Enter the clues you found, separated by commas, in order:</p>
      <p><i>(Hint: ROSE,KEY,LOVE,HEART,ROSES,PINK,SMILE,HUG)</i></p>
      <input id="finalInput" placeholder="Enter clues here..." />
      <button id="finalBtn">Submit</button>
      <div id="message"></div>
    `;

    document.getElementById('finalBtn').onclick = () => {
      const val = document.getElementById('finalInput').value.trim().toUpperCase();
      const msg = document.getElementById('message');
      const expected = ['ROSE','KEY','LOVE','HEART','ROSES','PINK','SMILE','HUG'];
      const userClues = val.split(',').map(s => s.trim());
      if(userClues.length !== expected.length){
        msg.style.color = '#f88';
        msg.textContent = 'You need to enter all 8 clues!';
        return;
      }
      for(let i=0; i<expected.length; i++){
        if(userClues[i] !== expected[i]){
          msg.style.color = '#f88';
          msg.textContent = `Clue ${i+1} is incorrect!`;
          return;
        }
      }
      currentState = STATE.LOVE_LETTER;
      renderLoveLetter();
    };
  }

  /* --- LOVE LETTER --- */
  function renderLoveLetter() {
    app.innerHTML = `
      <h2>üíå ILY üíå</h2>
      
      </p>
      <button id="restartBtn">Play Again</button>
    `;
    document.getElementById('restartBtn').onclick = () => {
      clues = [];
      currentState = STATE.START;
      renderStart();
    };
  }

  /* ----- Initialize ----- */
  function init() {
    currentState = STATE.START;
    renderStart();
  }

  init();

</script>
</body>
</html>
